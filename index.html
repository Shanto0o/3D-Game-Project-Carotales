<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Carotales</title>
    <style>

    @font-face {
      font-family: 'MyGameFont';
      src: url('images/Kawaii Stitch.ttf') format('truetype');
      /* ajouter src: url(...) format('woff2') si vous avez plusieurs formats */
      font-weight: normal;
      font-style: normal;
    }
      html, body {
        font-family: 'MyGameFont', sans-serif;
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
        padding: 0;
      }
      body{background: url('./images/carotales.png') no-repeat center center fixed;
      background-color: #000;     
      background-size: contain;}
      #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }
      #timerDisplay {
        display : none
      }
      #menu {
        position: absolute;
        left: 68%;       /* 3/4 de la largeur */
        top: 35%;        /* 1/2 de la hauteur */
        z-index: 100;
        /* plus de fond */
        background: transparent;
        padding: 0;          /* optionnel : enlève le padding autour du bouton */
      } 
      #shopInterface {
      position: absolute;
      inset: 0;
      z-index: 200;
      background: rgba(0, 0, 0, 0.5);
      display: none;      /* caché au départ */
      /* plus besoin de display: flex ici */
      flex-direction: row;
    }
    #shopInterface.show {
  display: flex;      /* on passe en flex quand on ajoute la classe .show */
}

      /* Colonne gauche : image décor */
      #shopInterface .shop-left {
        flex: 1;
        background: url('images/shop.png') no-repeat center center; /* :contentReference[oaicite:0]{index=0}&#8203;:contentReference[oaicite:1]{index=1} */
        background-size: cover;
      }

      /* Colonne droite : liste des upgrades */
      #shopInterface .shop-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        padding: 30px;
        overflow-y: auto;
      }
      /* 1. Assure-toi que la colonne fait toute la hauteur dispo */
      #shopInterface.show .shop-right {
        height: 100%;
        box-sizing: border-box;
        
        /* 2. on retire le gap et on met un padding top/bottom à 10% */
        /*    => laisse 80% de zone "utile" entre ces paddings */
        padding: 10% 30px;
        
        /* 3. on affiche en flex-column et on espace les items */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;  /* si tu veux centrer horizontalement */
      }

      /* 4. tes items reprennent leur largeur 80% si besoin */
      .shop-right .item {
        position: relative; 
        flex: 0 0 auto;   /* taille selon le contenu */
        width: 60%;       /* 80% de la largeur de .shop-right */
        margin: 0;        /* on gère l’espacement avec justify-content */
      }
      /* 2) Transition + zoom de l’image */
      .shop-right .item img {
        transition: transform 0.2s ease;
      }
      .shop-right .item:hover img {
        transform: scale(1.1);
      }

      /* 3) Style de la bulle de description (tooltip) */
      .shop-right .item .tooltip {
        position: absolute;
        bottom: 100%;             /* au‑dessus de l’item */
        left: 50%;
        transform: translateX(-50%);
        margin-bottom: 8px;
        padding: 6px 10px;
        background: rgba(0, 0, 0, 0.85);
        color: #fff;
        font-size: 14px;
        white-space: nowrap;
        border-radius: 4px;
        
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 10;

        /* +++ Ajustements pour agrandir la bulle +++ */
        font-size: 20px;           /* taille de texte plus grande */
        line-height: 1.4;          /* espacement entre les lignes */
        padding: 10px 14px;        /* plus de marge interne */
        min-width: 120px;          /* largeur minimale */
        text-align: center;        /* centrer le texte si multi‑ligne */
        border-radius: 6px;        /* coins plus arrondis si souhaité */
      }

      /* 4) Au survol : on fait apparaître la bulle */
      .shop-right .item:hover .tooltip {
        opacity: 1;
      }

      /* Style d’un item (image + bouton) */
      #shopInterface .item {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }
      #shopInterface .item img {
        width: 64px;
        height: 64px;
        margin-right: 15px;
        border-radius: 8px;
        box-shadow: 0 0 8px rgba(0,0,0,0.6);
      }
      #shopInterface .item button {
        flex: 1;
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background: #ff8c00;
        color: #fff;
        transition: background .2s;
      }
      #shopInterface .item button:hover {
        background: #e07b00;
      }
      #scoreDisplay, #timerDisplay {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 5px;
        color: white;
      }
      #timerDisplay {
        top: 60px;
      }
      #playButton {
      width: 280px;
      height: auto;
      cursor: pointer;
      transition: transform .15s ease;
    }
    #playButton:hover { transform: scale(1.05); }
    #playButton:active {
      transform: scale(0.95);   /* petit effet de clic */
    }  
    #skillsBar img{
      width:64px; height:64px;
      opacity:.9; border:2px solid #fff; border-radius:8px;
      box-shadow:0 0 8px rgba(0,0,0,.6);
}    
    #fishingInterface {
      display: none;            /* caché par défaut */
      position: absolute;
      inset: 0;                 /* couvre tout l’écran */
      background: rgba(0,0,0,0.7);
      align-items: center;      /* centrer le contenu */
      justify-content: center;
      z-index: 300;
    }


    /* Le bar */
    #fishingBar {
      position: relative;
      width: 50px;    /* ou la taille que vous voulez */
      height: 300px;
      background: #444;
      border-radius: 8px;
      overflow: hidden;
    }
    /* La zone rouge */
    #fishingRedZone {
      position: absolute;
      width: 100%;
      height: 60px;         /* hauteur cible */
      top: 120px;           /* placez‑la verticalement */
      background: rgba(255,0,0,0.5);
    }
    /* Le curseur blanc */
    #fishingHandle {
      position: absolute;
      width: 100%;
      height: 20px;
      background: #fff;
      bottom: 0;
      border-radius: 4px;
    }

    #introInterface {
    display: none;
    position: absolute;
    inset: 0;
    background: rgba(10, 10, 30, 0.8);
    backdrop-filter: blur(5px);
    z-index: 1000;

    align-items: center;
    justify-content: center;
    padding: 20px;
    }

    /* La “carte” centrale */
    #introInterface .card {
      max-width: 500px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      padding: 30px 25px;
      text-align: center;
      color: #fff;
      font-family: 'MyGameFont', sans-serif;
      animation: fadeIn 0.6s ease-out;
    }

    #introInterface .card h2 {
      margin-bottom: 15px;
      font-size: 2rem;
      text-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }

    #introInterface .card p {
      line-height: 1.5;
      margin-bottom: 25px;
      font-size: 1.1rem;
    }

    /* Bouton “Continuer” */
    #introInterface .btn-continue {
      background: linear-gradient(135deg, #ff9de2 0%, #fad0c4 100%);
      border: none;
      border-radius: 30px;
      padding: 12px 30px;
      font-size: 1.1rem;
      color: #222;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    #introInterface .btn-continue:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }
    #introInterface .btn-continue:active {
      transform: translateY(1px) scale(0.98);
    }

    #shopInterface #closeShopBtn {
        position: absolute;
        bottom: 20px;
        right: 20px;
        padding: 10px 15px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        background: #ff4c4c;
        color: #fff;      
        cursor: pointer;
        transition: background .2s;
        z-index: 10;
      }
      #shopInterface #closeShopBtn:hover {
        background: #e03c3c;
      }

      /* Écran You Lose */
      #loseMenu {
        display: none;              /* caché par défaut */
        position: absolute;
        inset: 0;                   /* couvre tout l'écran */
        background: rgba(250,240,255,0.9);
        backdrop-filter: blur(4px);
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      #loseMenu h1 {
        font-size: 4rem;
        color: #9b59b6;
        text-shadow: 0 0 20px rgba(155,89,182,0.6);
        margin-bottom: 1rem;
        font-family: 'MyGameFont', sans-serif;
      }
      #loseMenu button {
        padding: 12px 24px;
        font-size: 1.5rem;
        color: #fff;
        background: linear-gradient(135deg, #ffd1dc, #ff9ff3);
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: transform 0.2s;
      }
      #loseMenu button:hover {
        transform: scale(1.05);
      }
      #loseMenu button:active {
        transform: scale(0.95);
      }

    /* Animation d’apparition */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    </style>
    <!-- Utilisez la version max de Babylon.js (5.x) -->
    <script src="https://cdn.babylonjs.com/babylon.max.js"></script>
    <!-- Babylon.js loaders pour glTF/GLB -->
    <script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.min.js"></script>
    <!-- Babylon.js Havok Plugin -->
    <script src="https://cdn.babylonjs.com/havok/HavokPlugin.js"></script>


  <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <div id="menu">
      <img id="playButton" src="images/play.png" alt="Play DreamLand">
    </div>
    <div id="introInterface">
      <div class="card">

        <h2>Welcome to Carotales ! ✨</h2>
        <p>
          You play as an adventurous rabbit 🐰<br>
          Pick up carrots, avoid enemies,<br>
          Fish, dice and unlock powers! <br>
          <em>Tip: take advantage of the first level to harvest a max of carrots!</em>
        </p>
        <button id="introContinue" class="btn-continue">
          Continue
        </button>
      </div>
    </div>

    <div id="loseMenu">
      <h1>You Lose !</h1>
      <button id="retryButton">Retry</button>
    </div>

    <div id="shopInterface">
      <!-- Colonne gauche : image boutique -->
      <div class="shop-left"></div>
    
      <!-- Colonne droite : liste des améliorations -->
      <div class="shop-right">
        <div class="item" id="item-buyRange">
          <img src="images/buyRange.png" alt="Buy Range">
          <div class="tooltip">Add 0.2 pick up range.</div>
          <button id="buyRange">Buy Range (30 carottes)</button>
        </div>
        <div class="item" id="item-buyFreeze">
          <div class="tooltip">Freeze all the enemies for 5 seconds. Cooldown : 60s. Key : a </div>
          <img src="images/gel.png" alt="Gel Ennemis">
          <button id="buyFreeze">Gel ennemis (90 carottes)</button>
        </div>
        <div class="item" id="item-buySpeed">
          <img src="images/speed.png" alt="Speed Boost">
          <div class="tooltip">You speed is multiplied by 1.4 for 10 seconds. Cooldown : 60s. Key : r </div>
          <button id="buySpeed">Speed Boost (65 carottes)</button>
        </div>
        <div class="item" id="item-buyDonate">
          <img src="images/buyDonate.png" alt="Donner">
          <div class="tooltip">You see a tip jar on the stand. Maybe the owner will give you a smile ! </div>
          <button id="buyDonate">Déposer 15 carottes</button>
        </div>
        <div class="item" id="item-buyCarrotLover">
          <img src="images/buyCarrotLover.png" alt="Carrot Lover">
          <div class="tooltip">Gain +1 carrot everytime you pick up carrots</div>
          <button id="buyCarrotLover">Carrot Lover (80 carottes)</button>
        </div>
        <div class="item" id="item-buyInsurance">
          <img src="images/buyInsurance.png" alt="Assurance‑vie">
          <div class="tooltip">You respawn instantly after dying in the void for 1 time during a level.</div>
          <button id="buyInsurance">Assurance‑vie (80 carottes)</button>
        </div>
        <!-- Bouton suivant niveau en bas -->
        <div class="item" id="item-niveauSuivant">
          <img src="images/niveauSuivant.png" alt="Niveau Suivant">
          <button id="niveauSuivant">CLICK HERE to go to the Next Level</button>
        </div>
      </div>
      <button id="closeShopBtn">Close Shop</button>
    </div>
    
    
    <div id="timerDisplay">Time Left: <span id="timer"></span></div>

      <!-- Après : -->
      <div id="timerDisplay"
           style="display:none; position:absolute; top:60px; right:10px; z-index:100;
                  background:rgba(0,0,0,0.5); padding:10px; border-radius:5px; color:white;">
        Time Left: <span id="timer">30</span>
      </div>
    <div id="interactPrompt"
     style="
       position: absolute;
       bottom: 80px;
       left: 50%;
       transform: translateX(-50%);
       background: rgba(0,0,0,0.7);
       color: white;
       padding: 5px 10px;
       border-radius: 5px;
       font-size: 18px;
       display: none;
       z-index: 100;
     ">
  E : interagir
</div>
<div id="eurosDisplay"
     style="display:none; position:absolute; top:10px; left:10px; z-index:100;
            background:rgba(0,0,0,0.5); padding:5px 10px; border-radius:5px; color:white;">
  Carrots : <span id="eurosAmount">0</span>
</div>
<!-- Mini‑jeu de dés -->
<div id="miniGameInterface" style="display:none;
    position:absolute; top:40%; left:50%; transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.8); padding:20px; border-radius:8px; color:white; z-index:300;">
  <h3>Jeu de dés (€10 par partie)</h3>
  <p>Misez 10 € et lancez deux dés :</p>
  <button id="playDiceBtn">Lancer les dés</button>
  <button id="closeMiniGameBtn" style="margin-left:10px;">Quitter</button>
  <div id="diceResult" style="margin-top:15px;"></div>
</div>
<div id="deathScreen"
     style="display:none; position:absolute; top:50%; left:50%;
            transform:translate(-50%,-50%); background:rgba(0,0,0,.8);
            color:#fff; padding:25px 40px; border-radius:8px;
            font-size:28px; text-align:center; z-index:400;">
  Vous êtes mort.<br>
  Réapparition dans <span id="respawnTimer">3</span>…
</div>
<!-- Notification(ex : buy boutique) -->
<div id="toast"
     style="display:none; position:absolute; top:20%; left:50%;
            transform:translateX(-50%); padding:12px 24px;
            background:rgba(0,0,0,.8); color:#fff; font-size:22px;
            border-radius:8px; z-index:500; pointer-events:none;">
  <!-- message injecté dynamiquement -->
</div>
<!-- BARRE DES APTITUDES -->
<div id="skillsBar"
     style="display:none; position:absolute; bottom:10px; right:10px;
            z-index:150; gap:8px; height:70px; display:flex; align-items:end">
</div>

<!-- Mini‑jeu de pêche -->
<div id="fishingInterface"
     style="display:none;
            position:absolute;
            inset:0;
            background:rgba(0,0,0,0.7);
            align-items:center;
            justify-content:center;
            gap:40px;
            z-index:300;">

  <!-- 1) Instructions à gauche -->
  <div id="fishingInstructions"
       style="width:300px;
              color:white;
              padding:20px;
              background:rgba(0,0,0,0.5);
              border-radius:8px;
              text-align:left;">
    <h3 style="margin-top:0;">How to Fish</h3>
    <p>Press F to move your bobber !</p>
    <p>To catch your prize, you have to keep the bobber in the red area.</p>
  </div>

  <!-- 2) Barre de pêche au centre -->
  <div id="fishingBar"
       style="position:relative;
              width:50px;
              height:300px;
              background:#444;
              border-radius:8px;
              overflow:hidden;">
    <div id="fishingRedZone"
         style="position:absolute;
                width:100%;
                height:100px;
                top:100px;
                background:rgba(255,0,0,0.5);"></div>
    <div id="fishingHandle"
         style="position:absolute;
                width:100%;
                height:20px;
                background:#fff;
                bottom:0;
                border-radius:4px;
                transition:bottom 0.1s linear;"></div>
  </div>

  <!-- 3) Timer à droite, titre + encadré -->
  <div id="fishingTimer"
       style="color:white;
              text-align:center;
              font-size:16px;
              line-height:1.4;">
    <div>Red Zone Timer :</div>
    <div id="fishingTimerValue"
         style="margin-top:8px;
                padding:8px 12px;
                background:rgba(0,0,0,0.5);
                border:1px solid white;
                border-radius:4px;
                min-width:100px;">
      5 sec remaining
    </div>
  </div>

  <button id="leaveFishingBtn"
          style="padding:10px 20px; font-size:16px; cursor:pointer; border:none; border-radius:5px; background:#ff8c00; color:#fff;">
    Leave
  </button>

</div>
    <!-- Chargement du script principal en tant que module -->
    <script type="module" src="js/main.js"></script>
  </body>
</html>
